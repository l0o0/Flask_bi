{% extends "base.html" %}



{% block page_content %}
<header class="panel-heading clearfix">
    已保存的调查问卷 
    <span class="tools pull-right">
        <button class="btn btn-default dropdown-toggle" data-toggle="dropdown">Tools <i class="fa fa-angle-down"></i>
        </button>
        <ul class="dropdown-menu pull-right">
            <li><a href="#">导出为Excel</a></li>
        </ul>               
     </span>
</header>
<div class="panel-body">
<div class="adv-table editable-table ">
<div class="space15"></div>
<table class="table table-striped table-hover table-bordered" id="editable-sample">
<thead>
<tr>
    <th>Title</th>
    <th>Description</th>
    <th>Create</th>
    <th>Modify</th>
    <th>Public</th>
    <th>Preview</th>
    <th>Edit</th>                   
</tr>
</thead>
<tbody>
{% for item in query %}
<tr class="">
    <td >{{ item.get('title') }}</td>
    <td>{{ item.get('description') }}</td>
    <td>{{ item.get('createTime') }}</td>
    <td>{{ item.get('modifyTime') }}</td>
    <td>{{ item.get('public') }}</td>
    {% set hash = item.get('_id') %}
    <td><a href="{{ url_for('survey.survey_user', url_hash=hash, preview=1) }}"><span class="fa fa-chain" aria-hidden="true"></span></a></td>
    <td><button class="btn btn-success" data-toggle="modal" data-target="#myModal">Edit</button></td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
</div>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content"></div>
    </div>
    <div class="modal-dialog">
        <div class="modal-content"></div>
    </div>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"> <span aria-hidden="true" class="">×   </span><span class="sr-only">Close</span>

                </button>
                 <h4 class="modal-title" id="myModalLabel">调查问卷列表</h4>

            </div>
            <div class="modal-body"></div>
            <div class="modal-footer">               
                <button type="button" class="btn btn-primary" id='update'>保存</button>              
                    <button type="button" class="btn btn-success" id='redesign'>重新设计</button>
                <button type="button" class="btn btn-danger" id="delete">删除</button>
            </div>
        </div>
    </div>
</div>

{{ pagination.info }}
{% endblock %}

{% block scripts %}
{{ super() }} 
<script>
$(function(){
$(".btn[data-target='#myModal']").click(function() {
       var columnHeadings = $("thead th").map(function() {
                 return $(this).text().toLowerCase();
              }).get();
       columnHeadings.pop();
       columnHeadings.pop();
       var columnValues = $(this).parent().siblings().map(function() {
                 return $(this).text();
       }).get();
  var modalBody = $('<div id="modalContent"></div>');
  var modalForm = $('<form role="form" name="modalForm" action="{{ url_for('builder.formlist_update') }}" method="post"></form>');
  $.each(columnHeadings, function(i, columnHeader) {
       var formGroup = $('<div class="form-group"></div>');
       formGroup.append('<label for="'+columnHeader+'">'+columnHeader+'</label>');
       formGroup.append('<input class="form-control" name="'+columnHeader+'" id="'+columnHeader+'" value="'+columnValues[i]+'" />'); 
       modalForm.append(formGroup);
  });
  modalBody.append(modalForm);
  $('.modal-body').html(modalBody);
});
$('.modal-footer .btn-primary').click(function() {
   $('form[name="modalForm"]').submit();
});
}
);


var username='{{ current_user.username }}';
// 点击重新设计进行调查问卷的修改
$('#redesign').click(function(){
    var title = $('#modalContent #title').attr('value');
    var new_href = "/form/edit?username=" + username + '&title=' + title;
    window.location.replace(new_href);
});
$('#delete').click(function(){
    var title = $('#modalContent #title').attr('value');
    console.log(title);
    if (confirm('Are you sure?')){
        $.post('/form/edit', {'username':username, 'title':title});
        location.reload();
    } else {
        return false;
    }
});
</script>
{% endblock %}